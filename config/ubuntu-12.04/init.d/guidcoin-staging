#! /bin/sh
### BEGIN INIT INFO
# Provides:          guidcoin-staging
# Required-Start:    $local_fs $remote_fs $network $syslog
# Required-Stop:     $local_fs $remote_fs $network $syslog
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: starts the guidcoin staging FastCGI server
# Description:       starts guidcoin-staging
### END INIT INFO

NAME=guidcoin-staging
VIRTUALPYTHON="/var/www/python/guidcoin-staging/venv/bin/python"
MANAGEFILE="/var/www/python/guidcoin-staging/web/manage_staging.py"
PIDFILE="/var/fastcgi/guidcoin-staging.pid"
SOCKFILE="/var/fastcgi/guidcoin-staging.sock"

start() {
    exec sudo -u www-data $VIRTUALPYTHON $MANAGEFILE runfcgi socket=$SOCKFILE pidfile=$PIDFILE maxrequests=100 maxchildren=4
    return 0
}

stop() {
    if [ -f $PIDFILE ]; then
        kill `cat -- $PIDFILE`
        rm -f -- $PIDFILE
    fi
    return 0
}

case "$1" in
  start)
	echo "Starting $NAME"
	start
	;;
  stop)
	echo "Stopping $NAME"
	stop
	;;
  restart)
	echo "Restarting $NAME"
	stop
	start
	;;
  *)
	echo "Usage: $NAME {start|stop|restart}" >&2
	exit 1
	;;
esac

exit 0
